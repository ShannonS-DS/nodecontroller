#!/bin/bash
#This is configures an odroid to be a node controller

#install all dependencies for node
dpkg -i nc-wag-os/packages_o/*.deb
cd nc-wag-os/packages_o/
pip install -e pika-0.9.14

#Sets the odroid's hostname to NodeController so GuestNodes can easily find it
echo NodeController > /etc/hostname 

#set waggle parameters
mkdir /etc/waggle/
host_name=$RANDOM 
echo " " > /etc/waggle/queuename
echo "$host_name" > /etc/waggle/hostname # The node's waggle hostname
echo "$host_name, \n" > /etc/waggle/devices
echo "1,2,3,4, \n" >> /etc/waggle/devices
echo "$host_name:5, \n" >> /etc/waggle/devices

# Get the IP for the server you want to connect to
read -p "Enter the IP address of the cloud server you want to use: " server_ip
echo $server_ip > /etc/waggle/server_ip
cd

#move the data_cache.sh and communications.sh into the init.d folder
cd waggle/nodecontroller/nc-wag-os/waggled
mv communications.sh /etc/init.d
chmod +x /etc/init.d/communications.sh 
update-rc.d communications.sh defaults 

mv data_cache.sh /etc/init.d
chmod +x /etc/init.d/data_cache.sh 
update-rc.d data_cache.sh defaults 

echo "Odroid is now going reboot."
reboot

